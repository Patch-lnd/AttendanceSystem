<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Attendance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ===== VIBRATION ===== */
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-3px); }
            40% { transform: translateX(3px); }
            60% { transform: translateX(-2px); }
            80% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }
        .shake {
            animation: shake 0.4s ease-in-out;
        }

        /* ===== GLOW VERT ===== */
        @keyframes glow-green {
            0% { box-shadow: 0 0 0 rgba(34,197,94,0); }
            50% { box-shadow: 0 0 25px rgba(34,197,94,0.7); }
            100% { box-shadow: 0 0 0 rgba(34,197,94,0); }
        }
        .glow-green {
            animation: glow-green 1s ease-out;
        }

        /* ===== GLOW ROUGE ===== */
        @keyframes glow-red {
            0% { box-shadow: 0 0 0 rgba(239,68,68,0); }
            50% { box-shadow: 0 0 25px rgba(239,68,68,0.7); }
            100% { box-shadow: 0 0 0 rgba(239,68,68,0); }
        }
        .glow-red {
            animation: glow-red 1s ease-out;
        }
    </style>
</head>

<body class="bg-gray-900 min-h-screen p-8">

<h1 class="text-3xl font-bold text-center text-white mb-10">
    Tableau de Présence
</h1>

<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">

    <% users.forEach(user => { %>
    <div class="user-card relative p-6 rounded-2xl text-white border border-white/25 shadow-lg
        <%= user.is_present ? 'bg-green-500/30' : 'bg-red-500/30' %>"
        data-uid="<%= user.rfid_uid %>"
        data-present="<%= user.is_present %>">

        <!-- Reflet -->
        <div class="absolute inset-0 bg-gradient-to-br from-white/30 via-white/10 to-transparent pointer-events-none"></div>

        <!-- Contenu -->
        <div class="relative z-10">
            <h2 class="text-xl font-semibold"><%= user.full_name %></h2>
            <p class="text-sm mt-2 opacity-90">UID : <%= user.rfid_uid %></p>
            <p class="mt-4 text-lg font-bold"><%= user.is_present ? 'PRÉSENT' : 'ABSENT' %></p>
        </div>

    </div>
    <% }); %>

</div>

<!-- ===== SCRIPT ANIMATION ===== -->
<script>
    const cards = document.querySelectorAll('.user-card');

    cards.forEach(card => {
        const uid = card.dataset.uid;  // Récupère l'UID unique
        const isPresent = card.dataset.present === 'true'; // Etat actuel

        const previousState = localStorage.getItem(uid); // Dernier état connu

        // Si changement d'état détecté
        if (previousState !== null && previousState !== String(isPresent)) {

            // Choix de la couleur glow selon l'état actuel
            const glowClass = isPresent ? 'glow-green' : 'glow-red';

            // Ajoute glow + shake
            card.classList.add('shake', glowClass);

            // Retire les classes après 1.2 secondes
            setTimeout(() => {
                card.classList.remove('shake', glowClass);
            }, 1200);
        }

        // Sauvegarde l'état actuel pour la prochaine vérification
        localStorage.setItem(uid, isPresent);
    });
</script>

</body>
</html>
